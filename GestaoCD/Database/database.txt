-- Sequências
CREATE SEQUENCE usuario_seq;
CREATE SEQUENCE centro_dist_seq;
CREATE SEQUENCE produto_seq;
CREATE SEQUENCE estoque_seq;
CREATE SEQUENCE movimentacao_seq;

-- Tabela de usuários
CREATE TABLE usuarios (
	id BIGINT NOT NULL DEFAULT nextval('usuario_seq'),
	nome VARCHAR(100) NOT NULL,
	email VARCHAR(254) NOT NULL UNIQUE,
	senha VARCHAR(255) NOT NULL UNIQUE,
	cargo VARCHAR(50) NOT NULL,
	PRIMARY KEY (id)
);

-- Tabela de centros de distribuição
CREATE TABLE centros_distribuicao (
	id BIGINT NOT NULL DEFAULT nextval('centro_dist_seq'),
	usuario_id BIGINT,
	nome VARCHAR(50) NOT NULL,
	endereco VARCHAR(100) NOT NULL,
	cidade VARCHAR(50) NOT NULL,
	uf VARCHAR(2) NOT NULL,
	cep VARCHAR(9) NOT NULL,
	PRIMARY KEY (id),
	CONSTRAINT fk_cd_usuario FOREIGN KEY (usuario_id)
		REFERENCES usuarios(id) ON DELETE CASCADE
);

-- Tabela de produtos
CREATE TABLE produtos (
	id BIGINT NOT NULL DEFAULT nextval('produto_seq'),
	usuario_id BIGINT,
	nome VARCHAR(50) NOT NULL,
	categoria VARCHAR(40) NOT NULL,
	unidade FLOAT NOT NULL,
	PRIMARY KEY (id),
	CONSTRAINT fk_produto_usuario FOREIGN KEY (usuario_id)
		REFERENCES usuarios(id) ON DELETE CASCADE
);

-- Tabela de estoques
CREATE TABLE estoques (
	id BIGINT NOT NULL DEFAULT nextval('estoque_seq'),
	produto_id BIGINT,
	cd_id BIGINT,
	quantidade BIGINT,
	PRIMARY KEY (id),
	CONSTRAINT fk_estoque_produto FOREIGN KEY (produto_id)
		REFERENCES produtos(id) ON DELETE CASCADE,
	CONSTRAINT fk_estoque_cd FOREIGN KEY (cd_id)
		REFERENCES centros_distribuicao(id) ON DELETE CASCADE
);

-- Tabela de movimentações
CREATE TABLE movimentacoes (
	id BIGINT NOT NULL DEFAULT nextval('movimentacao_seq'),
	origem_cd_id BIGINT,
	destino_cd_id BIGINT,
	produto_id BIGINT,
	quantidade BIGINT,
	data DATE,
	status INT,
	PRIMARY KEY (id),
	CONSTRAINT fk_movimentacao_produto FOREIGN KEY (produto_id)
		REFERENCES produtos(id) ON DELETE CASCADE,
	CONSTRAINT fk_movimentacao_origem_cd FOREIGN KEY (origem_cd_id)
		REFERENCES centros_distribuicao(id) ON DELETE CASCADE,
	CONSTRAINT fk_movimentacao_destino_cd FOREIGN KEY (destino_cd_id)
		REFERENCES centros_distribuicao(id) ON DELETE CASCADE
);
